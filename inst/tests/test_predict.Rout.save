
R version 4.2.0 (2022-04-22 ucrt) -- "Vigorous Calisthenics"
Copyright (C) 2022 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(plm)
> data("Grunfeld", package = "plm")
> 
> Grunfeld.p <- pdata.frame(Grunfeld)
> 
> fit.plm.fe.id       <- plm(inv ~ value + capital, data = Grunfeld, model = "within")
> fit.plm.fe.id.unbal <- plm(inv ~ value + capital, data = Grunfeld[-c(198:200), ], model = "within")
> 
> ## ensure predict with newdata = original data gives same result
> (pred_orig1 <- predict(fit.plm.fe.id))
           1            2            3            4            5            6 
 269.5875965  459.3768572  571.6004798  302.0566378  467.7565649  505.3527552 
           7            8            9           10           11           12 
 510.0274150  381.1227596  458.0004039  474.4776307  544.9689214  594.1173144 
          13           14           15           16           17           18 
 554.1696352  574.1274986  653.4810372  684.0460514  836.3975405  915.6004762 
          19           20           21           22           23           24 
1168.1421618 1235.9902626  268.6199998  316.5688399  433.2488675  381.0168982 
          25           26           27           28           29           30 
 414.4085678  423.3161516  445.1066097  433.3368128  414.0902973  388.1986188 
          31           32           33           34           35           36 
 371.9488461  370.7234678  381.8705550  376.1041477  394.3461365  397.5688619 
          37           38           39           40           41           42 
 460.1076165  477.4381810  518.9570439  542.5234804  -76.3365255   18.7865450 
          43           44           45           46           47           48 
 109.7259294   37.4798886   66.4067638   57.0923268   34.8996620   28.5415652 
          49           50           51           52           53           54 
  56.2686446   49.8530355   84.6206036  114.8971637   88.3840870  109.6002968 
          55           56           57           58           59           60 
 113.8168223  142.5188475  172.9342718  218.5910787  273.7430655  343.9759279 
          61           62           63           64           65           66 
  21.4230797   67.6150950   80.2884032   36.4753039   66.9790565   73.1441945 
          67           68           69           70           71           72 
  66.3832994   39.5792419   57.7929362   67.8601234   82.3290609   96.9129025 
          73           74           75           76           77           78 
  65.9667131   82.8519004   82.9004183   99.1642273  124.3791599  142.3556992 
          79           80           81           82           83           84 
 189.7933099  178.2758746  -40.4463184  -32.8736965  -20.1985104   -6.9143526 
          85           86           87           88           89           90 
   6.6429951   12.4736303   21.3749245   32.5102551   34.3077810   51.7841356 
          91           92           93           94           95           96 
  63.8113863   76.7919526   88.4870368   94.6878789  107.2908224  117.1801881 
          97           98           99          100          101          102 
 133.4803952  151.0923358  169.3401045  175.2270556    0.5485190    4.8967733 
         103          104          105          106          107          108 
   9.9961355   12.8570946   23.4473380   25.9340289   26.4010047   31.8187138 
         109          110          111          112          113          114 
  37.7584544   41.9246480   41.1818979   50.3056169   56.2444217   61.4036900 
         115          116          117          118          119          120 
  76.2331587  102.0148662  106.3250864  116.1586836  129.8007631  152.9691054 
         121          122          123          124          125          126 
 -20.2878414   -5.7595327    0.7368423    2.3902715   11.6542741   18.5390550 
         127          128          129          130          131          132 
  23.7936917   29.9207255   38.5406183   45.1259517   51.6211554   59.5978744 
         133          134          135          136          137          138 
  62.4357202   68.4029535   74.3947896   82.1250222   92.8741302   97.8290838 
         139          140          141          142          143          144 
 104.7714220  113.2037925  -35.8988311   -0.4737221   25.0290795    9.7799053 
         145          146          147          148          149          150 
   6.9942440   19.8838852   12.8262033   23.1077944   36.5922695   39.7468899 
         151          152          153          154          155          156 
  52.2876487   52.8691151   40.9285819   55.8838718   50.7118850   54.7909153 
         157          158          159          160          161          162 
  62.3774269   82.7268290  128.0865246  139.5794838   -4.9897097   -1.2138637 
         163          164          165          166          167          168 
   6.4111594    1.2611210   16.4974176   13.8361771   14.8682217   13.1633396 
         169          170          171          172          173          174 
  36.0807397   41.4244813   53.3983124   44.6744702   48.1746247   56.8199797 
         175          176          177          178          179          180 
  57.9951852   59.6022925   71.4443571   93.4315611  104.7580806  110.1420524 
         181          182          183          184          185          186 
   2.6363294    4.5768516    3.9013318    1.3125242    3.6596138    4.2599369 
         187          188          189          190          191          192 
   3.2640428    1.4650024    1.3962960    1.2973328    1.7101252    2.0916769 
         193          194          195          196          197          198 
   1.7961548    2.5887267    3.5687591    3.7461762    5.3891298    4.7065188 
         199          200 
   4.0476824    4.2757883 
> (pred_orig2 <- predict(fit.plm.fe.id, newdata = Grunfeld.p))
      1-1935       1-1936       1-1937       1-1938       1-1939       1-1940 
 269.5875965  459.3768572  571.6004798  302.0566378  467.7565649  505.3527552 
      1-1941       1-1942       1-1943       1-1944       1-1945       1-1946 
 510.0274150  381.1227596  458.0004039  474.4776307  544.9689214  594.1173144 
      1-1947       1-1948       1-1949       1-1950       1-1951       1-1952 
 554.1696352  574.1274986  653.4810372  684.0460514  836.3975405  915.6004762 
      1-1953       1-1954       2-1935       2-1936       2-1937       2-1938 
1168.1421618 1235.9902626  268.6199998  316.5688399  433.2488675  381.0168982 
      2-1939       2-1940       2-1941       2-1942       2-1943       2-1944 
 414.4085678  423.3161516  445.1066097  433.3368128  414.0902973  388.1986188 
      2-1945       2-1946       2-1947       2-1948       2-1949       2-1950 
 371.9488461  370.7234678  381.8705550  376.1041477  394.3461365  397.5688619 
      2-1951       2-1952       2-1953       2-1954       3-1935       3-1936 
 460.1076165  477.4381810  518.9570439  542.5234804  -76.3365255   18.7865450 
      3-1937       3-1938       3-1939       3-1940       3-1941       3-1942 
 109.7259294   37.4798886   66.4067638   57.0923268   34.8996620   28.5415652 
      3-1943       3-1944       3-1945       3-1946       3-1947       3-1948 
  56.2686446   49.8530355   84.6206036  114.8971637   88.3840870  109.6002968 
      3-1949       3-1950       3-1951       3-1952       3-1953       3-1954 
 113.8168223  142.5188475  172.9342718  218.5910787  273.7430655  343.9759279 
      4-1935       4-1936       4-1937       4-1938       4-1939       4-1940 
  21.4230797   67.6150950   80.2884032   36.4753039   66.9790565   73.1441945 
      4-1941       4-1942       4-1943       4-1944       4-1945       4-1946 
  66.3832994   39.5792419   57.7929362   67.8601234   82.3290609   96.9129025 
      4-1947       4-1948       4-1949       4-1950       4-1951       4-1952 
  65.9667131   82.8519004   82.9004183   99.1642273  124.3791599  142.3556992 
      4-1953       4-1954       5-1935       5-1936       5-1937       5-1938 
 189.7933099  178.2758746  -40.4463184  -32.8736965  -20.1985104   -6.9143526 
      5-1939       5-1940       5-1941       5-1942       5-1943       5-1944 
   6.6429951   12.4736303   21.3749245   32.5102551   34.3077810   51.7841356 
      5-1945       5-1946       5-1947       5-1948       5-1949       5-1950 
  63.8113863   76.7919526   88.4870368   94.6878789  107.2908224  117.1801881 
      5-1951       5-1952       5-1953       5-1954       6-1935       6-1936 
 133.4803952  151.0923358  169.3401045  175.2270556    0.5485190    4.8967733 
      6-1937       6-1938       6-1939       6-1940       6-1941       6-1942 
   9.9961355   12.8570946   23.4473380   25.9340289   26.4010047   31.8187138 
      6-1943       6-1944       6-1945       6-1946       6-1947       6-1948 
  37.7584544   41.9246480   41.1818979   50.3056169   56.2444217   61.4036900 
      6-1949       6-1950       6-1951       6-1952       6-1953       6-1954 
  76.2331587  102.0148662  106.3250864  116.1586836  129.8007631  152.9691054 
      7-1935       7-1936       7-1937       7-1938       7-1939       7-1940 
 -20.2878414   -5.7595327    0.7368423    2.3902715   11.6542741   18.5390550 
      7-1941       7-1942       7-1943       7-1944       7-1945       7-1946 
  23.7936917   29.9207255   38.5406183   45.1259517   51.6211554   59.5978744 
      7-1947       7-1948       7-1949       7-1950       7-1951       7-1952 
  62.4357202   68.4029535   74.3947896   82.1250222   92.8741302   97.8290838 
      7-1953       7-1954       8-1935       8-1936       8-1937       8-1938 
 104.7714220  113.2037925  -35.8988311   -0.4737221   25.0290795    9.7799053 
      8-1939       8-1940       8-1941       8-1942       8-1943       8-1944 
   6.9942440   19.8838852   12.8262033   23.1077944   36.5922695   39.7468899 
      8-1945       8-1946       8-1947       8-1948       8-1949       8-1950 
  52.2876487   52.8691151   40.9285819   55.8838718   50.7118850   54.7909153 
      8-1951       8-1952       8-1953       8-1954       9-1935       9-1936 
  62.3774269   82.7268290  128.0865246  139.5794838   -4.9897097   -1.2138637 
      9-1937       9-1938       9-1939       9-1940       9-1941       9-1942 
   6.4111594    1.2611210   16.4974176   13.8361771   14.8682217   13.1633396 
      9-1943       9-1944       9-1945       9-1946       9-1947       9-1948 
  36.0807397   41.4244813   53.3983124   44.6744702   48.1746247   56.8199797 
      9-1949       9-1950       9-1951       9-1952       9-1953       9-1954 
  57.9951852   59.6022925   71.4443571   93.4315611  104.7580806  110.1420524 
     10-1935      10-1936      10-1937      10-1938      10-1939      10-1940 
   2.6363294    4.5768516    3.9013318    1.3125242    3.6596138    4.2599369 
     10-1941      10-1942      10-1943      10-1944      10-1945      10-1946 
   3.2640428    1.4650024    1.3962960    1.2973328    1.7101252    2.0916769 
     10-1947      10-1948      10-1949      10-1950      10-1951      10-1952 
   1.7961548    2.5887267    3.5687591    3.7461762    5.3891298    4.7065188 
     10-1953      10-1954 
   4.0476824    4.2757883 
> stopifnot(isTRUE(all.equal(pred_orig1, pred_orig2, check.attributes = FALSE)))
> 
> 
> # generate 40 new observations of two firms used for prediction:
> # firm 1 with years 1935:1964 and firm 2 with years 1935:1944
> set.seed(42L)
> new.value   <- runif(40, min = min(Grunfeld$value),   max = max(Grunfeld$value))
> new.capital <- runif(40, min = min(Grunfeld$capital), max = max(Grunfeld$capital))
> 
> newdata <- data.frame(firm = c(rep(1, 30), rep(2, 10)),
+                       year = c(1935:(1935+29), 1935:(1935+9)),
+                       value = new.value, capital = new.capital)
> 
> newdata.p <- pdata.frame(newdata, index = c("firm", "year"))
> 
> (pred.plm.fe.id         <- predict(fit.plm.fe.id, newdata = newdata.p))
   1-1935    1-1936    1-1937    1-1938    1-1939    1-1940    1-1941    1-1942 
 821.2125  875.1664  157.0304 1173.6444  671.2845  950.6111 1050.5341  469.6718 
   1-1943    1-1944    1-1945    1-1946    1-1947    1-1948    1-1949    1-1950 
1053.7527  843.5018  478.1369  665.3117  847.8006  651.7660  278.0225 1093.1700 
   1-1951    1-1952    1-1953    1-1954    1-1955    1-1956    1-1957    1-1958 
1069.8393  134.5369  439.9693  672.8864 1018.1634  709.0011 1133.8706  971.8999 
   1-1959    1-1960    1-1961    1-1962    1-1963    1-1964    2-1935    2-1936 
 578.8171  417.2556  389.2659 1124.5937  719.0662  671.6246  640.4913  757.7875 
   2-1937    2-1938    2-1939    2-1940    2-1941    2-1942    2-1943    2-1944 
 522.1571  905.9362  247.4660 1172.1281  118.9894  509.0686 1080.8802  526.2344 
> (pred.plm.fe.id.na.fill <- predict(fit.plm.fe.id, newdata = newdata.p, na.fill = TRUE))
   1-1935    1-1936    1-1937    1-1938    1-1939    1-1940    1-1941    1-1942 
 821.2125  875.1664  157.0304 1173.6444  671.2845  950.6111 1050.5341  469.6718 
   1-1943    1-1944    1-1945    1-1946    1-1947    1-1948    1-1949    1-1950 
1053.7527  843.5018  478.1369  665.3117  847.8006  651.7660  278.0225 1093.1700 
   1-1951    1-1952    1-1953    1-1954    1-1955    1-1956    1-1957    1-1958 
1069.8393  134.5369  439.9693  672.8864 1018.1634  709.0011 1133.8706  971.8999 
   1-1959    1-1960    1-1961    1-1962    1-1963    1-1964    2-1935    2-1936 
 578.8171  417.2556  389.2659 1124.5937  719.0662  671.6246  640.4913  757.7875 
   2-1937    2-1938    2-1939    2-1940    2-1941    2-1942    2-1943    2-1944 
 522.1571  905.9362  247.4660 1172.1281  118.9894  509.0686 1080.8802  526.2344 
> (pred.plm.fe.id.df      <- predict(fit.plm.fe.id, newdata = newdata))
         1          2          3          4          5          6          7 
 832.76525  886.71914  168.58320 1185.19721  682.83725  962.16388 1062.08685 
         8          9         10         11         12         13         14 
 481.22460 1065.30547  855.05453  489.68964  676.86450  859.35334  663.31873 
        15         16         17         18         19         20         21 
 289.57527 1104.72276 1081.39210  146.08965  451.52207  684.43919 1029.71622 
        22         23         24         25         26         27         28 
 720.55391 1145.42342  983.45267  590.36988  428.80840  400.81865 1136.14647 
        29         30         31         32         33         34         35 
 730.61893  683.17743  479.84158  597.13775  361.50732  745.28642   86.81626 
        36         37         38         39         40 
1011.47830  -41.66037  348.41883  920.23047  365.58466 
Warning message:
In predict.plm(fit.plm.fe.id, newdata = newdata) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> 
> ## one-way individual out-of-sample prediction
> newdata.oos <- data.frame(firm = c(rep(1, 30), rep(11, 10)),
+                           year = c(1935:(1935+29), 1935:(1935+9)),
+                           value = new.value, capital = new.capital)
> 
> newdata.oos.p <- pdata.frame(newdata.oos, index = c("firm", "year"))
> 
> (pred.plm.fe.id.oos <- predict(fit.plm.fe.id, newdata = newdata.oos.p))
   1-1935    1-1936    1-1937    1-1938    1-1939    1-1940    1-1941    1-1942 
 821.2125  875.1664  157.0304 1173.6444  671.2845  950.6111 1050.5341  469.6718 
   1-1943    1-1944    1-1945    1-1946    1-1947    1-1948    1-1949    1-1950 
1053.7527  843.5018  478.1369  665.3117  847.8006  651.7660  278.0225 1093.1700 
   1-1951    1-1952    1-1953    1-1954    1-1955    1-1956    1-1957    1-1958 
1069.8393  134.5369  439.9693  672.8864 1018.1634  709.0011 1133.8706  971.8999 
   1-1959    1-1960    1-1961    1-1962    1-1963    1-1964   11-1935   11-1936 
 578.8171  417.2556  389.2659 1124.5937  719.0662  671.6246        NA        NA 
  11-1937   11-1938   11-1939   11-1940   11-1941   11-1942   11-1943   11-1944 
       NA        NA        NA        NA        NA        NA        NA        NA 
> (pred.plm.fe.id.oos <- predict(fit.plm.fe.id, newdata = newdata.oos.p, na.fill = TRUE))
    1-1935     1-1936     1-1937     1-1938     1-1939     1-1940     1-1941 
 821.21247  875.16636  157.03042 1173.64443  671.28447  950.61110 1050.53408 
    1-1942     1-1943     1-1944     1-1945     1-1946     1-1947     1-1948 
 469.67183 1053.75269  843.50175  478.13686  665.31172  847.80056  651.76595 
    1-1949     1-1950     1-1951     1-1952     1-1953     1-1954     1-1955 
 278.02249 1093.16998 1069.83932  134.53687  439.96929  672.88641 1018.16344 
    1-1956     1-1957     1-1958     1-1959     1-1960     1-1961     1-1962 
 709.00113 1133.87064  971.89989  578.81710  417.25562  389.26587 1124.59369 
    1-1963     1-1964    11-1935    11-1936    11-1937    11-1938    11-1939 
 719.06615  671.62465  479.84158  597.13775  361.50732  745.28642   86.81626 
   11-1940    11-1941    11-1942    11-1943    11-1944 
1011.47830  -41.66037  348.41883  920.23047  365.58466 
> 
> (pred.plm.fe.id.df.oos <- predict(fit.plm.fe.id, newdata = newdata.oos))
         1          2          3          4          5          6          7 
 832.76525  886.71914  168.58320 1185.19721  682.83725  962.16388 1062.08685 
         8          9         10         11         12         13         14 
 481.22460 1065.30547  855.05453  489.68964  676.86450  859.35334  663.31873 
        15         16         17         18         19         20         21 
 289.57527 1104.72276 1081.39210  146.08965  451.52207  684.43919 1029.71622 
        22         23         24         25         26         27         28 
 720.55391 1145.42342  983.45267  590.36988  428.80840  400.81865 1136.14647 
        29         30         31         32         33         34         35 
 730.61893  683.17743  479.84158  597.13775  361.50732  745.28642   86.81626 
        36         37         38         39         40 
1011.47830  -41.66037  348.41883  920.23047  365.58466 
Warning message:
In predict.plm(fit.plm.fe.id, newdata = newdata.oos) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> 
> 
> ## one-way individual out-of-sample prediction - more complex pattern
> new.value2   <- runif(55, min = min(Grunfeld$value),   max = max(Grunfeld$value))
> new.capital2 <- runif(55, min = min(Grunfeld$capital), max = max(Grunfeld$capital))
> 
> newdata.oos2 <- data.frame(firm = c(rep(1, 30), rep(11, 10), rep(2, 15)),
+                            year = c(1935:(1935+29), 1935:(1935+9), 1935:(1935+14)),
+                            value = new.value2, capital = new.capital2)
> 
> newdata.oos2.p <- pdata.frame(newdata.oos2, index = c("firm", "year"))
> 
> (pred.plm.fe.id.oos2         <- predict(fit.plm.fe.id, newdata = newdata.oos2.p)) # sorted by ind. due to pdata.frame sorting (stacked)
   1-1935    1-1936    1-1937    1-1938    1-1939    1-1940    1-1941    1-1942 
 732.5061  610.6889  259.3070  903.5497  894.9806  422.6080  150.8808  317.8562 
   1-1943    1-1944    1-1945    1-1946    1-1947    1-1948    1-1949    1-1950 
 532.4534  650.3643  954.7723   53.9351  730.2840  774.3253  669.5454  932.6476 
   1-1951    1-1952    1-1953    1-1954    1-1955    1-1956    1-1957    1-1958 
 386.7959  824.5067  715.1524  826.2373  898.1577  213.8664  103.8959  294.8568 
   1-1959    1-1960    1-1961    1-1962    1-1963    1-1964    2-1935    2-1936 
1047.4733 1236.9236  820.0318  850.9114  437.1195  307.2398  445.6527  957.2505 
   2-1937    2-1938    2-1939    2-1940    2-1941    2-1942    2-1943    2-1944 
 907.7878 1058.2752 1129.2828 1011.0201 1329.7528  982.7544  446.4772 1114.1090 
   2-1945    2-1946    2-1947    2-1948    2-1949   11-1935   11-1936   11-1937 
1239.6095 1152.8956 1085.9270  838.8801  886.2603        NA        NA        NA 
  11-1938   11-1939   11-1940   11-1941   11-1942   11-1943   11-1944 
       NA        NA        NA        NA        NA        NA        NA 
> (pred.plm.fe.id.oos2.na.fill <- predict(fit.plm.fe.id, newdata = newdata.oos2.p, na.fill = TRUE))
   1-1935    1-1936    1-1937    1-1938    1-1939    1-1940    1-1941    1-1942 
 732.5061  610.6889  259.3070  903.5497  894.9806  422.6080  150.8808  317.8562 
   1-1943    1-1944    1-1945    1-1946    1-1947    1-1948    1-1949    1-1950 
 532.4534  650.3643  954.7723   53.9351  730.2840  774.3253  669.5454  932.6476 
   1-1951    1-1952    1-1953    1-1954    1-1955    1-1956    1-1957    1-1958 
 386.7959  824.5067  715.1524  826.2373  898.1577  213.8664  103.8959  294.8568 
   1-1959    1-1960    1-1961    1-1962    1-1963    1-1964    2-1935    2-1936 
1047.4733 1236.9236  820.0318  850.9114  437.1195  307.2398  445.6527  957.2505 
   2-1937    2-1938    2-1939    2-1940    2-1941    2-1942    2-1943    2-1944 
 907.7878 1058.2752 1129.2828 1011.0201 1329.7528  982.7544  446.4772 1114.1090 
   2-1945    2-1946    2-1947    2-1948    2-1949   11-1935   11-1936   11-1937 
1239.6095 1152.8956 1085.9270  838.8801  886.2603  486.4687  829.5568  678.4436 
  11-1938   11-1939   11-1940   11-1941   11-1942   11-1943   11-1944 
 336.3627  441.1756  817.3868  233.0573  475.8137  696.1805  807.3731 
> 
> (pred.plm.fe.id.df.oos2 <- predict(fit.plm.fe.id, newdata = newdata.oos2))
         1          2          3          4          5          6          7 
 744.05885  622.24166  270.85976  915.10247  906.53341  434.16074  162.43355 
         8          9         10         11         12         13         14 
 329.40897  544.00617  661.91709  966.32504   65.48788  741.83683  785.87808 
        15         16         17         18         19         20         21 
 681.09819  944.20039  398.34864  836.05952  726.70518  837.79008  909.71053 
        22         23         24         25         26         27         28 
 225.41919  115.44873  306.40963 1059.02610 1248.47641  831.58455  862.46421 
        29         30         31         32         33         34         35 
 448.67230  318.79255  486.46867  829.55682  678.44362  336.36269  441.17559 
        36         37         38         39         40         41         42 
 817.38675  233.05730  475.81372  696.18047  807.37314  285.00292  796.60071 
        43         44         45         46         47         48         49 
 747.13807  897.62543  968.63302  850.37031 1169.10306  822.10465  285.82741 
        50         51         52         53         54         55 
 953.45920 1078.95974  992.24589  925.27723  678.23033  725.61053 
Warning message:
In predict.plm(fit.plm.fe.id, newdata = newdata.oos2) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> (pred.plm.fe.id.unbal.oos2         <- predict(fit.plm.fe.id.unbal, newdata = newdata.oos2.p)) # sorted by ind. due to pdata.frame sorting (stacked)
    1-1935     1-1936     1-1937     1-1938     1-1939     1-1940     1-1941 
 732.50177  610.67616  259.30382  903.54459  894.97874  422.60744  150.87610 
    1-1942     1-1943     1-1944     1-1945     1-1946     1-1947     1-1948 
 317.84583  532.44001  650.35455  954.76699   53.92619  730.27091  774.32878 
    1-1949     1-1950     1-1951     1-1952     1-1953     1-1954     1-1955 
 669.55014  932.64421  386.79034  824.49961  715.15220  826.23262  898.15226 
    1-1956     1-1957     1-1958     1-1959     1-1960     1-1961     1-1962 
 213.86048  103.89150  294.85391 1047.47332 1236.92154  820.03005  850.90912 
    1-1963     1-1964     2-1935     2-1936     2-1937     2-1938     2-1939 
 437.11814  307.22747  445.65332  957.24544  907.78735 1058.27305 1129.28276 
    2-1940     2-1941     2-1942     2-1943     2-1944     2-1945     2-1946 
1011.01394 1329.75482  982.76216  446.47486 1114.10926 1239.61236 1152.89255 
    2-1947     2-1948     2-1949    11-1935    11-1936    11-1937    11-1938 
1085.92547  838.88919  886.26668         NA         NA         NA         NA 
   11-1939    11-1940    11-1941    11-1942    11-1943    11-1944 
        NA         NA         NA         NA         NA         NA 
> (pred.plm.fe.id.unbal.oos2.na.fill <- predict(fit.plm.fe.id.unbal, newdata = newdata.oos2.p, na.fill = TRUE))
    1-1935     1-1936     1-1937     1-1938     1-1939     1-1940     1-1941 
 732.50177  610.67616  259.30382  903.54459  894.97874  422.60744  150.87610 
    1-1942     1-1943     1-1944     1-1945     1-1946     1-1947     1-1948 
 317.84583  532.44001  650.35455  954.76699   53.92619  730.27091  774.32878 
    1-1949     1-1950     1-1951     1-1952     1-1953     1-1954     1-1955 
 669.55014  932.64421  386.79034  824.49961  715.15220  826.23262  898.15226 
    1-1956     1-1957     1-1958     1-1959     1-1960     1-1961     1-1962 
 213.86048  103.89150  294.85391 1047.47332 1236.92154  820.03005  850.90912 
    1-1963     1-1964     2-1935     2-1936     2-1937     2-1938     2-1939 
 437.11814  307.22747  445.65332  957.24544  907.78735 1058.27305 1129.28276 
    2-1940     2-1941     2-1942     2-1943     2-1944     2-1945     2-1946 
1011.01394 1329.75482  982.76216  446.47486 1114.10926 1239.61236 1152.89255 
    2-1947     2-1948     2-1949    11-1935    11-1936    11-1937    11-1938 
1085.92547  838.88919  886.26668  485.65656  828.74546  677.63229  335.54890 
   11-1939    11-1940    11-1941    11-1942    11-1943    11-1944 
 440.36235  816.56844  232.23419  474.99573  695.36558  806.56190 
> 
> (pred.plm.fe.id.unbal.df.oos2 <- predict(fit.plm.fe.id, newdata = newdata.oos2))
         1          2          3          4          5          6          7 
 744.05885  622.24166  270.85976  915.10247  906.53341  434.16074  162.43355 
         8          9         10         11         12         13         14 
 329.40897  544.00617  661.91709  966.32504   65.48788  741.83683  785.87808 
        15         16         17         18         19         20         21 
 681.09819  944.20039  398.34864  836.05952  726.70518  837.79008  909.71053 
        22         23         24         25         26         27         28 
 225.41919  115.44873  306.40963 1059.02610 1248.47641  831.58455  862.46421 
        29         30         31         32         33         34         35 
 448.67230  318.79255  486.46867  829.55682  678.44362  336.36269  441.17559 
        36         37         38         39         40         41         42 
 817.38675  233.05730  475.81372  696.18047  807.37314  285.00292  796.60071 
        43         44         45         46         47         48         49 
 747.13807  897.62543  968.63302  850.37031 1169.10306  822.10465  285.82741 
        50         51         52         53         54         55 
 953.45920 1078.95974  992.24589  925.27723  678.23033  725.61053 
Warning message:
In predict.plm(fit.plm.fe.id, newdata = newdata.oos2) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> 
> # one-way - time
> fit.plm.fe.ti       <- plm(inv ~ value + capital, data = Grunfeld, model = "within", effect = "time")
> fit.plm.fe.ti.unbal <- plm(inv ~ value + capital, data = Grunfeld[-c(198:200), ], model = "within", effect = "time")
> 
> firsttwoyears <- c(1, 2, 21, 22, 41, 42, 61, 62, 81, 82,  101, 102, 121, 122, 141, 142, 161, 162, 181, 182)
> newdata.ti <- data.frame(value = Grunfeld$value, capital = Grunfeld$capital, firm = Grunfeld$firm, year = c(rep(c(1935, 1936), 100)))[firsttwoyears, ]
> newdata.ti.p <- pdata.frame(newdata.ti, index = c("firm", "year"))
> 
> (pred.plm.fe.ti    <- predict(fit.plm.fe.ti,   newdata = newdata.ti.p))
     1-1935      1-1936      2-1935      2-1936      3-1935      3-1936 
336.6022137 515.2455261 147.3705582 181.3731649 134.6358311 217.5910487 
     4-1935      4-1936      5-1935      5-1936      6-1935      6-1936 
 27.4950296  59.3068899  35.0942893  23.6431839   0.8622901 -12.7533678 
     7-1935      7-1936      8-1935      8-1936      9-1935      9-1936 
 14.5577268  10.0472531  -0.8127187  19.6561185  45.9589364  31.4414745 
    10-1935     10-1936 
-14.3041566 -29.4812916 
> (pred.plm.fe.ti.df <- predict(fit.plm.fe.ti,   newdata = newdata.ti))
         1          2         21         22         41         42         61 
319.154684 515.010336 129.923028 181.137974 117.188301 217.355858  10.047499 
        62         81         82        101        102        121        122 
 59.071699  17.646759  23.407993 -16.585240 -12.988558  -2.889803   9.812063 
       141        142        161        162        181        182 
-18.260249  19.420928  28.511406  31.206284 -31.751687 -29.716482 
Warning message:
In predict.plm(fit.plm.fe.ti, newdata = newdata.ti) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> (pred.plm.fe.ti.unbal    <- predict(fit.plm.fe.ti.unbal,   newdata = newdata.ti.p))
     1-1935      1-1936      2-1935      2-1936      3-1935      3-1936 
336.1825364 514.8871649 147.2866314 181.2224315 134.7440081 217.6420561 
     4-1935      4-1936      5-1935      5-1936      6-1935      6-1936 
 27.3078765  59.0668853  35.6238204  24.2360690   0.6756857 -12.9232669 
     7-1935      7-1936      8-1935      8-1936      9-1935      9-1936 
 14.7537616  10.3188569  -1.0178759  19.4025370  46.3928434  31.9039531 
    10-1935     10-1936 
-14.4892876 -29.6866868 
> (pred.plm.fe.ti.unbal.df <- predict(fit.plm.fe.ti.unbal,   newdata = newdata.ti))
         1          2         21         22         41         42         61 
317.327773 513.264563 128.431868 179.599830 115.889244 216.019455   8.453113 
        62         81         82        101        102        121        122 
 57.444284  16.769057  22.613468 -18.179078 -14.545868  -4.101002   8.696255 
       141        142        161        162        181        182 
-19.872640  17.779936  27.538080  30.281352 -33.344051 -31.309288 
Warning message:
In predict.plm(fit.plm.fe.ti.unbal, newdata = newdata.ti) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> ## two-ways
> fit.plm.fe.tw       <- plm(inv ~ value + capital, data = Grunfeld, model = "within", effect = "twoways")
> fit.plm.fe.tw.unbal <- plm(inv ~ value + capital, data = Grunfeld[-c(198:200), ], model = "within", effect = "twoways")
> 
> newdata.tw <- data.frame(value = Grunfeld$value, capital = Grunfeld$capital, firm = Grunfeld$firm, year = c(rep(c(1935, 1936), 100)))[firsttwoyears, ]
> newdata.tw.p <- pdata.frame(newdata.tw, index = c("firm", "year"))
> 
> (pred.plm.fe.tw    <- predict(fit.plm.fe.tw,   newdata = newdata.tw.p))
    1-1935     1-1936     2-1935     2-1936     3-1935     3-1936     4-1935 
276.490195 461.484762 299.785986 331.755698 -49.328638  33.329645  61.358102 
    4-1936     5-1935     5-1936     6-1935     6-1936     7-1935     7-1936 
 91.529296  -8.204774 -18.756819  41.504892  27.201729  16.674379  13.663452 
    8-1935     8-1936     9-1935     9-1936    10-1935    10-1936 
  3.777120  22.420594  35.507989  20.664437  49.894747  32.777206 
> (pred.plm.fe.tw.df <- predict(fit.plm.fe.tw,   newdata = Grunfeld))
           1            2            3            4            5            6 
 283.2266302  487.4186024  610.1403509  323.3984996  500.3684008  540.6571160 
           7            8            9           10           11           12 
 546.9248373  410.4173824  491.5466542  507.5051696  584.5347000  640.7037640 
          13           14           15           16           17           18 
 607.5144096  633.1079686  720.5188019  755.2798542  921.0124154 1011.5742481 
          19           20           21           22           23           24 
1290.7078496 1375.1206105   99.4681812  150.6352983  277.1490596  225.0782183 
          25           26           27           28           29           30 
 262.1618665  270.1347785  293.6181116  282.0243989  261.5330799  233.2554261 
          31           32           33           34           35           36 
 214.1565790  210.6969761  226.1125107  221.0631462  241.7329387  245.3552226 
          37           38           39           40           41           42 
 311.7898120  333.0182307  382.1490091  408.5606243   92.6385962  194.4942843 
          43           44           45           46           47           48 
 292.0631815  215.8477562  247.2030657  237.6171275  214.8025593  209.7772860 
          49           50           51           52           53           54 
 240.2657374  233.4448940  270.5643679  303.6271580  278.2090489  303.1912254 
          55           56           57           58           59           60 
 309.6813977  341.1325846  374.2776256  424.5328744  485.4515200  562.8719683 
          61           62           63           64           65           66 
 -27.2593049   22.1092941   36.3049437  -10.0759594   22.8616878   29.5259860 
          67           68           69           70           71           72 
  22.5134328   -6.2391285   13.1163958   23.7028925   39.0131330   55.4019360 
          73           74           75           76           77           78 
  22.6399801   41.0440110   42.0807327   59.8840860   87.9042931  109.4261004 
          79           80           81           82           83           84 
 161.6034557  151.1134557    3.9702563   12.6156165   27.0118336   42.6864561 
          85           86           87           88           89           90 
  58.0097672   64.7956938   74.9381030   87.8868657   90.3219241  110.1521191 
          91           92           93           94           95           96 
 123.7816024  138.5942670  151.9428130  159.3309716  173.7585120  185.1477292 
          97           98           99          100          101          102 
 203.1435433  223.1716210  243.8687717  250.9717012  -54.6473160  -49.7530738 
         103          104          105          106          107          108 
 -43.9871072  -40.6244515  -29.0552435  -26.2938661  -25.5564242  -19.2621932 
         109          110          111          112          113          114 
 -12.5449623   -8.1392014   -8.9410999    0.8619198    7.6655169   13.6040658 
         115          116          117          118          119          120 
  30.0356896   57.9945832   62.9408306   74.0559896   88.9430275  114.4287316 
         121          122          123          124          125          126 
 -28.0557967  -11.8693185   -4.4644168   -2.0960227    8.5929485   16.6963126 
         127          128          129          130          131          132 
  23.0862708   30.2763964   40.1259466   47.6391769   55.0587114   63.9824743 
         133          134          135          136          137          138 
  67.6089975   74.4059184   81.2688503   90.1356364  102.1844155  107.9125064 
         139          140          141          142          143          144 
 115.8444185  125.5226405  -56.9769597  -19.1360810    8.2996435   -7.7175455 
         145          146          147          148          149          150 
 -10.5522898    3.3054009   -3.9820404    7.6596520   22.6985640   26.2506952 
         151          152          153          154          155          156 
  39.6877968   40.1399120   28.0407008   44.5432808   39.3112485   43.5364704 
         157          158          159          160          161          162 
  51.4606813   73.6312929  122.8938423  136.2037092   12.0268685   16.3807217 
         163          164          165          166          167          168 
  24.7696942   19.6617272   36.2131771   33.7655885   35.1600050   33.7082324 
         169          170          171          172          173          174 
  58.8939243   64.8178667   78.5173261   68.8214073   73.3835818   83.3132989 
         175          176          177          178          179          180 
  84.8607461   86.7374972   99.7930867  123.9050298  136.7801778  143.1971938 
         181          182          183          184          185          186 
 -70.2059407  -68.1260773  -68.8518746  -71.6194220  -69.1152870  -68.4780777 
         187          188          189          190          191          192 
 -69.5450126  -71.4757584  -71.5558202  -71.6661066  -71.2275033  -70.8217651 
         193          194          195          196          197          198 
 -71.1199227  -70.2335276  -69.1327165  -68.9073272  -67.1423700  -67.8492727 
         199          200 
 -68.5071992  -68.1932096 
Warning message:
In predict.plm(fit.plm.fe.tw, newdata = Grunfeld) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> (pred.plm.fe.tw.unbal    <- predict(fit.plm.fe.tw.unbal,   newdata = newdata.tw.p))
    1-1935     1-1936     2-1935     2-1936     3-1935     3-1936     4-1935 
273.133335 460.338576 299.856023 331.856119 -49.882033  33.522268  62.738289 
    4-1936     5-1935     5-1936     6-1935     6-1936     7-1935     7-1936 
 92.917340  -7.620615 -18.714906  43.047659  28.140085  17.879774  14.435228 
    8-1935     8-1936     9-1935     9-1936    10-1935    10-1936 
  4.980122  23.470027  37.123157  21.669963  46.204288  28.435300 
> (pred.plm.fe.tw.unbal.df <- predict(fit.plm.fe.tw.unbal,   newdata = Grunfeld))
            1             2             3             4             5 
 283.73127290  490.81456180  615.33760523  324.64004685  504.07394829 
            6             7             8             9            10 
 544.92799173  551.32419193  412.95374514  495.18102042  511.30874532 
           11            12            13            14            15 
 589.46713899  646.53712869  613.19191194  639.28009035  727.99394319 
           16            17            18            19            20 
 763.30741011  931.44508417 1023.46084714 1306.78520847 1392.75949454 
           21            22            23            24            25 
  97.45275694  149.33090015  277.66748432  224.99167133  262.63756754 
           26            27            28            29            30 
 270.67169931  294.48881058  282.76523903  261.99068994  233.29911972 
           31            32            33            34            35 
 213.87799290  210.30070476  226.04432608  220.96050842  241.95645859 
           36            37            38            39            40 
 245.63500601  312.98302156  334.59489127  384.56447970  411.38398275 
           41            42            43            44            45 
  90.56550679  193.84785582  292.78959207  215.54352096  247.35029819 
           46            47            48            49            50 
 237.64259261  214.53905535  209.50086702  240.44211455  233.52730845 
           51            52            53            54            55 
 271.16319360  304.70982221  279.03148054  304.43656856  311.08132046 
           56            57            58            59            60 
 342.99617010  376.62405984  427.62728382  489.45925809  568.03556741 
           61            62            63            64            65 
 -31.07975926   18.97733902   33.39198176  -13.62137576   19.78648061 
           66            67            68            69            70 
  26.54614815   19.44268562   -9.71425976    9.90762296   20.63617247 
           71            72            73            74            75 
  36.15496663   52.79823310   19.58946460   38.26171141   39.34469963 
           76            77            78            79            80 
  57.40994047   85.85551882  107.75204644  160.70479127  150.12726057 
           81            82            83            84            85 
   0.73313897    9.51689540   24.14131572   40.08223833   55.64617388 
           86            87            88            89            90 
  62.54464066   72.84881115   86.01199502   88.49761109  108.64156632 
           91            92            93            94            95 
 122.48616208  137.53574660  151.09787944  158.61364852  173.27333429 
           96            97            98            99           100 
 184.84786277  203.11320791  223.45951649  244.48389041  251.71207543 
          101           102           103           104           105 
 -58.85328821  -53.88281426  -48.02623146  -44.60683085  -32.86818115 
          106           107           108           109           110 
 -30.06494481  -29.30952037  -22.91123326  -16.08840501  -11.62271691 
          111           112           113           114           115 
 -12.43605933   -2.49465051    4.41857014   10.45364817   27.13323705 
          116           117           118           119           120 
  55.49510255   60.52129949   71.81102143   86.91558428  112.78010058 
          121           122           123           124           125 
 -31.81067703  -15.37717461   -7.85408940   -5.43324652    5.43024073 
          126           127           128           129           130 
  13.67068040   20.17475034   27.48587651   37.49335869   45.12671132 
          131           132           133           134           135 
  52.66514644   61.72623115   65.42249911   72.32775355   79.30122229 
          136           137           138           139           140 
  88.31120369  100.54611752  106.36805793  114.42713027  124.26183441 
          141           142           143           144           145 
 -61.21945155  -22.85149862    4.97263218  -11.25886973  -14.12854577 
          146           147           148           149           150 
  -0.07495765   -7.45577547    4.36936458   19.63826482   23.24576636 
          151           152           153           154           155 
  36.87135870   37.32431010   25.07775771   41.82724092   36.53179002 
          156           157           158           159           160 
  40.81159921   48.84037861   71.33380657  121.30868134  134.83732333 
          161           162           163           164           165 
   8.88402701   13.30888111   21.82258487   16.65617889   33.44709214 
          166           167           168           169           170 
  30.97818020   32.40145474   30.94139686   56.50068962   62.51411803 
          171           172           173           174           175 
  76.43376979   66.59061149   71.24293668   81.33341405   82.91185418 
          176           177           178           179           180 
  84.81991796   98.07047350  122.53847250  135.61803811  142.14595266 
          181           182           183           184           185 
 -74.63068568  -72.52162593  -73.25766872  -76.06383557  -73.52491850 
          186           187           188           189           190 
 -72.87896469  -73.96086159  -75.91879170  -76.00018420  -76.11215460 
          191           192           193           194           195 
 -75.66751774  -75.25618735  -75.55793180  -74.65790504  -73.54001784 
          196           197           198           199           200 
 -73.31032998  -71.52046724  -72.23649689  -72.90210621  -72.58147046 
Warning message:
In predict.plm(fit.plm.fe.tw.unbal, newdata = Grunfeld) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> 
> # two-ways - out-of-sample prediction
> (pred.plm.fe.tw.oos2         <- predict(fit.plm.fe.tw,   newdata = newdata.oos2.p))
    1-1935     1-1936     1-1937     1-1938     1-1939     1-1940     1-1941 
 805.43253  670.25367  231.45811  959.92333  912.21821  404.51830  135.47133 
    1-1942     1-1943     1-1944     1-1945     1-1946     1-1947     1-1948 
 334.23646  560.36760  683.58539 1001.32699   24.77404  785.16475  789.55574 
    1-1949     1-1950     1-1951     1-1952     1-1953     1-1954     1-1955 
 639.25672  951.69859  358.34002  850.86778  708.24204  817.91906         NA 
    1-1956     1-1957     1-1958     1-1959     1-1960     1-1961     1-1962 
        NA         NA         NA         NA         NA         NA         NA 
    1-1963     1-1964     2-1935     2-1936     2-1937     2-1938     2-1939 
        NA         NA  495.66226 1063.88044  975.82379 1150.05670 1194.22127 
    2-1940     2-1941     2-1942     2-1943     2-1944     2-1945     2-1946 
1101.82103 1464.69246 1059.28662  460.79951 1202.79584 1324.66442 1266.53448 
    2-1947     2-1948     2-1949    11-1935    11-1936    11-1937    11-1938 
1179.37796  872.09643  902.06284         NA         NA         NA         NA 
   11-1939    11-1940    11-1941    11-1942    11-1943    11-1944 
        NA         NA         NA         NA         NA         NA 
> (pred.plm.fe.tw.oos2.na.fill <- predict(fit.plm.fe.tw,   newdata = newdata.oos2.p, na.fill = TRUE))
    1-1935     1-1936     1-1937     1-1938     1-1939     1-1940     1-1941 
 805.43253  670.25367  231.45811  959.92333  912.21821  404.51830  135.47133 
    1-1942     1-1943     1-1944     1-1945     1-1946     1-1947     1-1948 
 334.23646  560.36760  683.58539 1001.32699   24.77404  785.16475  789.55574 
    1-1949     1-1950     1-1951     1-1952     1-1953     1-1954     1-1955 
 639.25672  951.69859  358.34002  850.86778  708.24204  817.91906 1000.78930 
    1-1956     1-1957     1-1958     1-1959     1-1960     1-1961     1-1962 
 234.68016  107.77280  318.18120 1154.76257 1372.27813  904.00087  940.03032 
    1-1963     1-1964     2-1935     2-1936     2-1937     2-1938     2-1939 
 473.86224  354.95748  495.66226 1063.88044  975.82379 1150.05670 1194.22127 
    2-1940     2-1941     2-1942     2-1943     2-1944     2-1945     2-1946 
1101.82103 1464.69246 1059.28662  460.79951 1202.79584 1324.66442 1266.53448 
    2-1947     2-1948     2-1949    11-1935    11-1936    11-1937    11-1938 
1179.37796  872.09643  902.06284  513.23685  896.02344  726.54804  349.04802 
   11-1939    11-1940    11-1941    11-1942    11-1943    11-1944 
 465.20692  899.38474  256.04298  515.66359  755.12668  870.87322 
> 
> (pred.plm.fe.tw.oos2.df <- predict(fit.plm.fe.tw,   newdata = newdata.oos2))
         1          2          3          4          5          6          7 
 812.16897  696.18751  278.88455 1005.88617  988.42493  455.48982  161.01222 
         8          9         10         11         12         13         14 
 362.11269  610.08166  733.42060 1063.74647   62.67975  831.29343  840.00869 
        15         16         17         18         19         20         21 
 719.48825 1034.33114  427.55737  922.23656  782.69644  918.18171 1000.78930 
        22         23         24         25         26         27         28 
 234.68016  107.77280  318.18120 1154.76257 1372.27813  904.00087  940.03032 
        29         30         31         32         33         34         35 
 473.86224  354.95748  513.23685  896.02344  726.54804  349.04802  465.20692 
        36         37         38         39         40         41         42 
 899.38474  256.04298  515.66359  755.12668  870.87322  295.34445  882.76004 
        43         44         45         46         47         48         49 
 816.19599  988.96530 1063.37376  945.73830 1283.17912  880.10861  303.45933 
        50         51         52         53         54         55 
1045.57680 1180.02966 1097.38596 1018.45240  715.49514  775.24013 
Warning message:
In predict.plm(fit.plm.fe.tw, newdata = newdata.oos2) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> (pred.plm.fe.tw.unbal.oos2         <- predict(fit.plm.fe.tw.unbal,   newdata = newdata.oos2.p))
    1-1935     1-1936     1-1937     1-1938     1-1939     1-1940     1-1941 
 810.55657  673.53861  226.95910  967.42110  918.72712  402.58053  129.26581 
    1-1942     1-1943     1-1944     1-1945     1-1946     1-1947     1-1948 
 331.74905  561.69455  686.50183 1008.78427   16.84468  789.45250  792.53578 
    1-1949     1-1950     1-1951     1-1952     1-1953     1-1954     1-1955 
 640.03979  957.74361  354.65899  851.70856  705.00690  813.99117         NA 
    1-1956     1-1957     1-1958     1-1959     1-1960     1-1961     1-1962 
        NA         NA         NA         NA         NA         NA         NA 
    1-1963     1-1964     2-1935     2-1936     2-1937     2-1938     2-1939 
        NA         NA  498.67940 1075.72151  985.67849 1163.32223 1207.99946 
    2-1940     2-1941     2-1942     2-1943     2-1944     2-1945     2-1946 
1114.13409 1481.57812 1069.69303  462.80608 1216.03084 1339.55803 1280.41024 
    2-1947     2-1948     2-1949    11-1935    11-1936    11-1937    11-1938 
1191.93549  878.98134  909.83453         NA         NA         NA         NA 
   11-1939    11-1940    11-1941    11-1942    11-1943    11-1944 
        NA         NA         NA         NA         NA         NA 
> (pred.plm.fe.tw.unbal.oos2.na.fill <- predict(fit.plm.fe.tw.unbal,   newdata = newdata.oos2.p, na.fill = TRUE))
    1-1935     1-1936     1-1937     1-1938     1-1939     1-1940     1-1941 
 810.55657  673.53861  226.95910  967.42110  918.72712  402.58053  129.26581 
    1-1942     1-1943     1-1944     1-1945     1-1946     1-1947     1-1948 
 331.74905  561.69455  686.50183 1008.78427   16.84468  789.45250  792.53578 
    1-1949     1-1950     1-1951     1-1952     1-1953     1-1954     1-1955 
 640.03979  957.74361  354.65899  851.70856  705.00690  813.99117 1012.77926 
    1-1956     1-1957     1-1958     1-1959     1-1960     1-1961     1-1962 
 234.86325  105.88326  319.43001 1168.71864 1389.75335  914.21178  950.84145 
    1-1963     1-1964     2-1935     2-1936     2-1937     2-1938     2-1939 
 477.39959  357.47951  498.67940 1075.72151  985.67849 1163.32223 1207.99946 
    2-1940     2-1941     2-1942     2-1943     2-1944     2-1945     2-1946 
1114.13409 1481.57812 1069.69303  462.80608 1216.03084 1339.55803 1280.41024 
    2-1947     2-1948     2-1949    11-1935    11-1936    11-1937    11-1938 
1191.93549  878.98134  909.83453  517.29035  905.93544  733.83911  350.69029 
   11-1939    11-1940    11-1941    11-1942    11-1943    11-1944 
 468.60280  909.87228  256.95031  520.19710  763.12708  880.38794 
> 
> (pred.plm.fe.tw.unbal.oos2.df <- predict(fit.plm.fe.tw.unbal,   newdata = newdata.oos2))
         1          2          3          4          5          6          7 
 821.15451  704.01460  279.54327 1017.92570  999.95279  458.67849  159.96282 
         8          9         10         11         12         13         14 
 364.59913  616.62748  741.59995 1076.69354   60.42953  841.24005  848.83810 
        15         16         17         18         19         20         21 
 726.36122 1046.68165  430.69051  933.13629  790.91809  928.83419 1012.77926 
        22         23         24         25         26         27         28 
 234.86325  105.88326  319.43001 1168.71864 1389.75335  914.21178  950.84145 
        29         30         31         32         33         34         35 
 477.39959  357.47951  517.29035  905.93544  733.83911  350.69029  468.60280 
        36         37         38         39         40         41         42 
 909.87228  256.95031  520.19710  763.12708  880.38794  296.27613  893.19629 
        43         44         45         46         47         48         49 
 825.26146 1000.82563 1076.22393  957.23084 1299.27393  889.54190  304.73781 
        50         51         52         53         54         55 
1058.12776 1194.46609 1110.99389 1030.72182  722.28245  783.15477 
Warning message:
In predict.plm(fit.plm.fe.tw.unbal, newdata = newdata.oos2) :
  Data supplied in argument 'newdata' is not a pdata.frame; weighted mean of fixed effects as in original model used for prediction, see ?predict.plm.
> 
> 
> ### test versus  fixest::predict (fixest::predict does not do out-of-sample)
> fixest.avail <- if(!requireNamespace("fixest", quietly = TRUE)) FALSE else TRUE
> 
> if(fixest.avail) {
+   suppressPackageStartupMessages(library(fixest))
+   
+   # one-way individual
+   fit.feols.fe.id <- feols(inv ~ value + capital | firm, data = Grunfeld)
+   pred.feols.fe.id <- predict(fit.feols.fe.id, newdata = newdata)
+   stopifnot(isTRUE(all.equal(pred.feols.fe.id, as.numeric(pred.plm.fe.id), check.attributes = FALSE)))
+   
+   # one-way individual - out-of-sample prediction
+   pred.feols.fe.id.oos2 <- predict(fit.feols.fe.id, newdata = newdata.oos2.p)
+   stopifnot(isTRUE(all.equal(pred.feols.fe.id.oos2, as.numeric(pred.plm.fe.id.oos2), check.attributes = FALSE)))
+ 
+   # one-way individual unbalanced - out-of-sample prediction
+   fit.feols.fe.id.unbal <- feols(inv ~ value + capital | firm, data = Grunfeld[-c(198:200), ])
+   pred.feols.fe.id.unbal.oos2 <- predict(fit.feols.fe.id.unbal, newdata = newdata.oos2.p)
+   stopifnot(isTRUE(all.equal(pred.feols.fe.id.unbal.oos2, as.numeric(pred.plm.fe.id.unbal.oos2), check.attributes = FALSE)))
+   
+   # one-way time
+   fit.feols.fe.ti <- feols(inv ~ value + capital | year, Grunfeld)
+   pred.feols.fe.ti <- predict(fit.feols.fe.ti, newdata = newdata.ti)
+   stopifnot(isTRUE(all.equal(pred.feols.fe.ti, as.numeric(pred.plm.fe.ti), check.attributes = FALSE)))
+   
+   # one-way time unbalanced
+   fit.feols.fe.ti.unbal <- feols(inv ~ value + capital | year, data = Grunfeld[-c(198:200), ])
+   pred.feols.fe.ti.unbal <- predict(fit.feols.fe.ti.unbal, newdata = newdata.ti.p)
+   stopifnot(isTRUE(all.equal(pred.feols.fe.ti.unbal, as.numeric(pred.plm.fe.ti.unbal), check.attributes = FALSE)))
+   
+   # twoways
+   fit.feols.fe.tw <- feols(inv ~ value + capital | firm + year, Grunfeld)
+   pred.feols.fe.tw <- predict(fit.feols.fe.tw, newdata = newdata.tw)
+   stopifnot(isTRUE(all.equal(pred.feols.fe.tw, as.numeric(pred.plm.fe.tw), check.attributes = FALSE)))
+   
+   # twoways - out-of-sample prediction
+   pred.feols.fe.tw.oos2 <- predict(fit.feols.fe.tw, newdata = newdata.oos2.p)
+   stopifnot(isTRUE(all.equal(pred.feols.fe.tw.oos2, as.numeric(pred.plm.fe.tw.oos2), check.attributes = FALSE)))
+   
+   # twoways unbalanced - out-of-sample prediction
+   fit.feols.fe.tw.unbal <- feols(inv ~ value + capital | firm + year, Grunfeld[-c(198:200), ])
+   pred.feols.fe.tw.unbal.oos2 <- predict(fit.feols.fe.tw.unbal, newdata = newdata.oos2.p)
+   stopifnot(isTRUE(all.equal(pred.feols.fe.tw.unbal.oos2, as.numeric(pred.plm.fe.tw.unbal.oos2), check.attributes = FALSE)))
+ }
> 
> 
> #### corner cases
> 
> # NA in newdata
> datNA <- data.frame(id = c(1,1,2,2,3), time = c(1,2,1,2,1), 
+                    y = c(1,3,5,10,8), x = c(1, NA, 3,4,5))
> datNA.p <- pdata.frame(datNA)
> 
> pool <- plm(y ~ x, data = datNA.p, index = c("id", "time"), model="pooling")
> 
> (predNA <- predict(pool, datNA.p))
     1-1      2-1      2-2      3-1 
1.371429 5.485714 7.542857 9.600000 
> (index(predNA)) # index may have only 4 rows left as one row is removed due to NA in data
  id time
1  1    1
3  2    1
4  2    2
5  3    1
> stopifnot(nrow(index(predNA)) == 4L)
> 
> (predict(pool, datNA))
       1        3        4        5 
1.371429 5.485714 7.542857 9.600000 
> 
> # FE model without intercept in formula
> fe0 <- plm(y ~ 0 + x, data = datNA.p, index = c("id", "time"), model="pooling")
> (pred.fe0.NA <- predict(fe0, datNA.p))
     1-1      2-1      2-2      3-1 
1.882353 5.647059 7.529412 9.411765 
> 
> 
> #### random effects
> fit.plm.re.id <- plm(inv ~ value + capital, data = Grunfeld, model = "random")
> 
> (predict(fit.plm.re.id))
          1           2           3           4           5           6 
 280.989579  470.139125  581.910557  313.153754  478.343832  515.819288 
          7           8           9          10          11          12 
 520.431998  391.880534  468.558081  485.045762  555.255105  604.115076 
         13          14          15          16          17          18 
 563.936855  583.673717  662.683858  693.075849  844.845943  923.582404 
         19          20          21          22          23          24 
1174.995807 1242.189372  108.307905  156.110811  272.361026  220.151241 
         25          26          27          28          29          30 
 253.387164  262.324806  284.040352  272.270340  253.080649  227.291951 
         31          32          33          34          35          36 
 211.157229  210.015855  220.997699  215.207657  233.349234  236.555315 
         37          38          39          40          41          42 
 298.914985  316.090792  357.303296  380.750877  100.808852  195.629427 
         43          44          45          46          47          48 
 286.272421  214.213449  243.034122  233.734840  211.577354  205.172971 
         49          50          51          52          53          54 
 232.782076  226.385047  261.046114  291.202396  264.662785  285.727061 
         55          56          57          58          59          60 
 289.856496  318.440476  348.737659  394.198284  449.105386  519.032218 
         61          62          63          64          65          66 
  -8.765598   37.282987   49.892666    6.199004   36.595499   42.738689 
         67          68          69          70          71          72 
  35.990831    9.273928   27.435196   37.477577   51.907321   66.415960 
         73          74          75          76          77          78 
  35.554209   52.373624   52.385253   68.582853   93.679529  111.514116 
         79          80          81          82          83          84 
 158.749312  147.199768   15.924371   23.452889   36.057033   49.244849 
         85          86          87          88          89          90 
  62.729002   68.520855   77.371047   88.432720   90.205494  107.584609 
         91          92          93          94          95          96 
 119.545600  132.450816  144.077908  150.231112  162.759190  172.587268 
         97          98          99         100         101         102 
 188.815425  206.327730  224.474279  230.312692  -34.204794  -29.879253 
        103         104         105         106         107         108 
 -24.807510  -21.966810  -11.418802   -8.943700   -8.487065   -3.104978 
        109         110         111         112         113         114 
   2.802554    6.957562    6.217419   15.310873   21.214213   26.341627 
        115         116         117         118         119         120 
  41.103325   66.789900   71.074068   80.854551   94.442825  117.512217 
        121         122         123         124         125         126 
 -11.811695    2.646917    9.105894   10.731760   19.937606   26.773214 
        127         128         129         130         131         132 
  31.982664   38.066733   46.636103   53.183268   59.640486   67.577571 
        133         134         135         136         137         138 
  70.384465   76.317527   82.273635   89.957297  100.652121  105.575560 
        139         140         141         142         143         144 
 112.477237  120.858581  -36.256721   -0.940850   24.476081    9.263788 
        145         146         147         148         149         150 
   6.481461   19.328033   12.282732   22.508037   35.927248   39.065337 
        151         152         153         154         155         156 
  51.565890   52.151868   40.223699   55.113198   49.946243   54.017618 
        157         158         159         160         161         162 
  61.587437   81.857918  127.047540  138.466519   23.982291   27.734538 
        163         164         165         166         167         168 
  35.326947   30.178119   45.357132   42.689358   43.707328   41.993925 
        169         170         171         172         173         174 
  64.814340   70.133553   82.036550   73.353678   76.812327   85.405104 
        175         176         177         178         179         180 
  86.565790   88.161971   99.952375  121.848451  133.111088  138.453618 
        181         182         183         184         185         186 
 -48.663325  -46.729048  -47.402328  -49.983070  -47.643106  -47.044483 
        187         188         189         190         191         192 
 -48.037190  -49.830346  -49.898592  -49.997079  -49.585472  -49.205029 
        193         194         195         196         197         198 
 -49.500293  -48.711649  -47.736651  -47.561119  -45.923603  -46.604940 
        199         200 
 -47.263454  -47.038675 
> 
> (pred.plm.re    <- predict(fit.plm.re.id, newdata = newdata.p))
    1-1935     1-1936     1-1937     1-1938     1-1939     1-1940     1-1941 
 830.06582  883.72828  168.70233 1180.09569  680.48961  957.79141 1057.55693 
    1-1942     1-1943     1-1944     1-1945     1-1946     1-1947     1-1948 
 479.04663 1060.58265  851.75984  488.15908  674.72226  856.52958  660.25610 
    1-1949     1-1950     1-1951     1-1952     1-1953     1-1954     1-1955 
 289.31463 1100.36559 1077.26472  145.98462  450.26927  681.90489 1025.75329 
    1-1956     1-1957     1-1958     1-1959     1-1960     1-1961     1-1962 
 716.87774 1140.91599  979.87352  587.39138  427.78367  399.70120 1131.51710 
    1-1963     1-1964     2-1935     2-1936     2-1937     2-1938     2-1939 
 727.54798  681.24897  478.98001  595.69694  360.63285  742.63975   86.83819 
    2-1940     2-1941     2-1942     2-1943     2-1944 
1007.47597  -40.82212  347.23540  916.96251  365.16964 
> (pred.plm.re.df <- predict(fit.plm.re.id, newdata = newdata))
         1          2          3          4          5          6          7 
 830.06582  883.72828  168.70233 1180.09569  680.48961  957.79141 1057.55693 
         8          9         10         11         12         13         14 
 479.04663 1060.58265  851.75984  488.15908  674.72226  856.52958  660.25610 
        15         16         17         18         19         20         21 
 289.31463 1100.36559 1077.26472  145.98462  450.26927  681.90489 1025.75329 
        22         23         24         25         26         27         28 
 716.87774 1140.91599  979.87352  587.39138  427.78367  399.70120 1131.51710 
        29         30         31         32         33         34         35 
 727.54798  681.24897  478.98001  595.69694  360.63285  742.63975   86.83819 
        36         37         38         39         40 
1007.47597  -40.82212  347.23540  916.96251  365.16964 
> 
> proc.time()
   user  system elapsed 
   1.93    0.43    2.31 
